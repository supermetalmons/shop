rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // NOTE: The frontend authenticates with Firebase Anonymous Auth and uses callable Cloud Functions
    // (Admin SDK) for all profile/address reads and writes.
    // We intentionally deny all direct Firestore client access.

    // User data (backend-only via Cloud Functions / Admin SDK).
    match /profiles/{wallet} {
      allow read, write: if false;

      match /addresses/{addressId} {
        allow read, write: if false;
      }
    }

    // Backend-only collections (used by Cloud Functions via Admin SDK).
    match /authSessions/{uid} {
      allow read, write: if false;
    }

    match /boxAssignments/{boxAssetId} {
      allow read, write: if false;
    }

    match /dudeAssignments/{dudeId} {
      allow read, write: if false;
    }

    match /meta/dudePool {
      allow read, write: if false;
    }

    match /claimCodes/{code} {
      allow read, write: if false;
    }

    match /deliveryOrders/{deliveryId} {
      allow read, write: if false;
    }

    // Default deny: nothing else is accessible from the client.
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
